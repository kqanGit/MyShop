<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MyShop_Frontend.Views.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MyShop_Frontend.Views.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <!-- Base card style -->
        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="18"/>
            <Setter Property="Padding" Value="18"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#11000000"/>
        </Style>

        <!-- Pill style button (Today) -->
        <Style x:Key="PillButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Background" Value="#F3F5F9"/>
            <Setter Property="BorderBrush" Value="#11000000"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- Pastel backgrounds like the screenshot -->
        <SolidColorBrush x:Key="CardPink" Color="#FFEFF3"/>
        <SolidColorBrush x:Key="CardBeige" Color="#FFF7EA"/>
        <SolidColorBrush x:Key="CardMint" Color="#E9FFEF"/>
        <SolidColorBrush x:Key="CardLavender" Color="#F1EBFF"/>
        <SolidColorBrush x:Key="CardLightBlue" Color="#EEF4FF"/>

        <SolidColorBrush x:Key="IconPink" Color="#FFD7DD"/>
        <SolidColorBrush x:Key="IconOrange" Color="#FFE1B8"/>
        <SolidColorBrush x:Key="IconGreen" Color="#C9F2D0"/>
        <SolidColorBrush x:Key="IconPurple" Color="#E2D6FF"/>
        <SolidColorBrush x:Key="IconBlue" Color="#D9E6FF"/>
    </Page.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Padding="24" RowDefinitions="Auto,Auto,Auto,*" RowSpacing="16">
            <!-- ===== Title row + filters (giữ binding) ===== -->
            <Grid Grid.Row="1" ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" RowSpacing="10">
                <StackPanel Grid.Row="0" Spacing="4">
                    <TextBlock Text="Today's Sales" FontSize="16" FontWeight="SemiBold" Foreground="#1E2A4A"/>
                    <TextBlock Text="Sales Summary" FontSize="12" Opacity="0.6"/>
                </StackPanel>

                <!-- Today pill (UI only) -->
                <Button Grid.Column="1" Grid.Row="0" Style="{StaticResource PillButtonStyle}" Content="Today"/>

                <!-- Filters row (giữ binding đủ) -->
                <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" Spacing="12">
                    <DatePicker Date="{Binding FromDate, Mode=TwoWay}" />
                    <DatePicker Date="{Binding ToDate, Mode=TwoWay}" />

                    <ComboBox Width="160"
                              SelectedValuePath="Tag"
                              SelectedValue="{Binding SelectedGroupBy, Mode=TwoWay}">
                        <ComboBoxItem Content="Ngày" Tag="1"/>
                        <ComboBoxItem Content="Tuần" Tag="2"/>
                        <ComboBoxItem Content="Tháng" Tag="3"/>
                        <ComboBoxItem Content="Năm" Tag="4"/>
                    </ComboBox>

                    <Button Content="Refresh" Click="Refresh_Click"/>
                </StackPanel>
            </Grid>

            <!-- ===== KPI cards row ===== -->
            <Grid Grid.Row="2" ColumnDefinitions="*,*,*,*,1.2*" ColumnSpacing="12">

                <!-- Total Sales -->
                <Border Style="{StaticResource CardBorderStyle}" Background="{StaticResource CardPink}">
                    <StackPanel Spacing="10">
                        <Border Width="34" Height="34" CornerRadius="17" Background="{StaticResource IconPink}" HorizontalAlignment="Center">
                            <FontIcon Glyph="&#xE8A7;" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>

                        <TextBlock Text="{Binding TotalRevenueText}" FontSize="22" FontWeight="SemiBold" Foreground="#1E2A4A"/>
                        <TextBlock Text="Total Sales" Opacity="0.65"/>
                        <TextBlock Text="+8% from yesterday" Foreground="#3B82F6" FontSize="12"/>
                    </StackPanel>
                </Border>

                <!-- Profit -->
                <Border Grid.Column="1" Style="{StaticResource CardBorderStyle}" Background="{StaticResource CardBeige}">
                    <StackPanel Spacing="10">
                        <Border Width="34" Height="34" CornerRadius="17" Background="{StaticResource IconOrange}" HorizontalAlignment="Center">
                            <FontIcon Glyph="&#xEAFD;" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>

                        <TextBlock Text="{Binding TotalProfitText}" FontSize="22" FontWeight="SemiBold" Foreground="#1E2A4A"/>
                        <TextBlock Text="Profit" Opacity="0.65"/>
                        <TextBlock Text="+5% from yesterday" Foreground="#3B82F6" FontSize="12"/>
                    </StackPanel>
                </Border>

                <!-- Orders Today -->
                <Border Grid.Column="2" Style="{StaticResource CardBorderStyle}" Background="{StaticResource CardMint}">
                    <StackPanel Spacing="10">
                        <Border Width="34" Height="34" CornerRadius="17" Background="{StaticResource IconGreen}" HorizontalAlignment="Center">
                            <FontIcon Glyph="&#xE8CB;" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>

                        <TextBlock Text="{Binding TotalOrdersText}" FontSize="22" FontWeight="SemiBold" Foreground="#1E2A4A"/>
                        <TextBlock Text="Orders Today" Opacity="0.65"/>
                        <TextBlock Text="+12% from yesterday" Foreground="#3B82F6" FontSize="12"/>
                    </StackPanel>
                </Border>

                <!-- New Customers (ảnh có nhưng backend chưa có => placeholder) -->
                <Border Grid.Column="3" Style="{StaticResource CardBorderStyle}" Background="{StaticResource CardLavender}">
                    <StackPanel Spacing="10">
                        <Border Width="34" Height="34" CornerRadius="17" Background="{StaticResource IconPurple}" HorizontalAlignment="Center">
                            <FontIcon Glyph="&#xE77B;" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>

                        <TextBlock Text="8" FontSize="22" FontWeight="SemiBold" Foreground="#1E2A4A"/>
                        <TextBlock Text="New Customers" Opacity="0.65"/>
                        <TextBlock Text="+0.5% from yesterday" Foreground="#3B82F6" FontSize="12"/>
                    </StackPanel>
                </Border>

                <!-- Total Products / Stock health (ảnh có nhưng backend chưa có => placeholder) -->
                <!--<Border Grid.Column="4" Style="{StaticResource CardBorderStyle}" Background="{StaticResource CardLightBlue}">
                    <StackPanel Spacing="10">
                        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <Border Width="34" Height="34" CornerRadius="17" Background="{StaticResource IconBlue}">
                                    <FontIcon Glyph="&#xE8A5;" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Total Products" Opacity="0.65" VerticalAlignment="Center"/>
                            </StackPanel>

                            <Border Grid.Column="1" Background="#D1FAE5" CornerRadius="12" Padding="10,4" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Ellipse Width="8" Height="8" Fill="#10B981" VerticalAlignment="Center"/>
                                    <TextBlock Text="In stock" FontSize="12" Foreground="#047857"/>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <TextBlock Text="128" FontSize="22" FontWeight="SemiBold" Foreground="#1E2A4A"/>

                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Text="Stock health" Opacity="0.65"/>
                            <TextBlock Grid.Column="1" Text="78%" Foreground="#3B82F6" FontSize="12"/>
                        </Grid>

                        <ProgressBar Minimum="0" Maximum="100" Value="78" Height="6" CornerRadius="3"/>
                    </StackPanel>
                --><!--</Border>-->
                
            </Grid>

            <!-- ===== Bottom content: Chart + Right list ===== -->
            <Grid Grid.Row="3" ColumnDefinitions="1.4*,1*" ColumnSpacing="12">

                <!-- Chart card: dùng RevenueChart binding (giữ binding) -->
                <Border Style="{StaticResource CardBorderStyle}" Background="White">
                    <StackPanel Spacing="10">
                        <StackPanel>
                            <TextBlock Text="Revenue in the current month" FontSize="16" FontWeight="SemiBold" Foreground="#1E2A4A"/>
                            <TextBlock Text="Month" Opacity="0.6" FontSize="12"/>
                        </StackPanel>

                        <!-- Nếu bạn muốn đúng chart thật thì cần custom control/chart lib.
                             Ở đây hiển thị giống ảnh: bar placeholder nhưng vẫn giữ data list ở dưới -->
                        <Border BorderBrush="#11000000" BorderThickness="1" CornerRadius="14" Padding="18" Background="Transparent">
                            <StackPanel Spacing="10">
                                <!-- Placeholder bars -->
                                <Grid Height="220" VerticalAlignment="Bottom">
                                    <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Bottom">
                                        <Border Width="30" Height="90" CornerRadius="8" Background="#2563EB"/>
                                        <Border Width="30" Height="140" CornerRadius="8" Background="#2563EB"/>
                                        <Border Width="30" Height="110" CornerRadius="8" Background="#2563EB"/>
                                        <Border Width="30" Height="170" CornerRadius="8" Background="#2563EB"/>
                                        <Border Width="30" Height="130" CornerRadius="8" Background="#2563EB"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Data list (bind thật) -->
                                <ListView ItemsSource="{Binding RevenueChart}" Margin="0,8,0,0">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnDefinitions="120,*,*" Padding="4">
                                                <TextBlock Text="{Binding DateLabel}" />
                                                <TextBlock Grid.Column="1" Text="{Binding Revenue}" />
                                                <TextBlock Grid.Column="2" Text="{Binding Profit}" />
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Right card: giống “Latest 3 orders”, nhưng bind từ TopSellingProducts -->
                <Border Grid.Column="1" Style="{StaticResource CardBorderStyle}" Background="White">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Latest 3 orders" FontSize="16" FontWeight="SemiBold" Foreground="#1E2A4A"/>

                        <Grid ColumnDefinitions="*,Auto" Opacity="0.6">
                            <TextBlock Text="Order / Customer"/>
                            <TextBlock Grid.Column="1" Text="Total"/>
                        </Grid>

                        <!-- bind list TopSellingProducts, chỉ show 3 item đầu -->
                        <ListView ItemsSource="{Binding TopSellingProducts}">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="*,Auto" Padding="0,10">
                                        <StackPanel Spacing="2">
                                            <!-- dùng ProductName thay cho order code (vì backend chỉ có top products) -->
                                            <TextBlock Text="{Binding ProductName}" FontWeight="SemiBold" Foreground="#1E2A4A" TextWrapping="Wrap"/>
                                            <TextBlock Opacity="0.65" FontSize="12">
                                                <Run Text="Qty: "/>
                                                <Run Text="{Binding QuantitySold}"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" HorizontalAlignment="Right" Spacing="2">
                                            <TextBlock Text="{Binding Revenue}" FontWeight="SemiBold" Foreground="#1E2A4A" HorizontalAlignment="Right"/>
                                            <TextBlock Text="—" Opacity="0.6" FontSize="12" HorizontalAlignment="Right"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>

                        </ListView>
                    </StackPanel>
                </Border>

            </Grid>

            <!-- Error (giữ binding) -->
            <TextBlock Grid.Row="4"
                       Foreground="Tomato"
                       Text="{Binding Error}"
                       TextWrapping="WrapWholeWords"
                       Margin="0,12,0,0"/>
        </Grid>
    </ScrollViewer>
</Page>
